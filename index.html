

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adarsh Portal 2026 - Master Dashboard</title>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@700;800;900&display=swap" rel="stylesheet">

    <style>
        :root { --primary: #0f172a; --accent: #2563eb; --success: #10b981; --danger: #ef4444; --bg: #f4f7fa; }
        
        /* FULL BOLD DASHBOARD */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; font-weight: 800 !important; }
        
        body { background: var(--bg); color: var(--primary); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        header { background: var(--primary); color: white; padding: 25px; text-align: center; flex-shrink: 0; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .search-box { max-width: 750px; margin: 10px auto 0; position: relative; }
        .search-box input { width: 100%; padding: 15px 50px; border-radius: 12px; border: none; font-size: 17px; outline: none; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .search-box i { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: var(--accent); font-size: 22px; }

        .stats-bar { max-width: 1200px; margin: 10px auto; display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 0 20px; flex-shrink: 0; }
        .stat-card { background: white; padding: 10px; border-radius: 12px; text-align: center; border-bottom: 5px solid var(--accent); }
        .stat-card p { font-size: 22px; color: var(--accent); }

        .controls { max-width: 1200px; margin: 5px auto; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; width: 100%; flex-shrink: 0; }
        .btn-group { display: flex; background: #e2e8f0; padding: 4px; border-radius: 10px; }
        .btn { border: none; padding: 8px 18px; border-radius: 8px; cursor: pointer; background: transparent; transition: 0.2s; color: #475569; }
        .btn.active { background: white; color: var(--accent); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        /* SCROLLABLE DATA AREA */
        #displayWrapper { flex-grow: 1; overflow-y: auto; padding: 10px 20px 30px; }

        /* GRID LAYOUT - Extra Info Cards */
        .grid-layout { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .card { background: white; border-radius: 15px; overflow: hidden; border: 3px solid #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.05); cursor: pointer; transition: 0.3s; }
        .card:hover { transform: translateY(-5px); border-color: var(--accent); }
        .card-img { width: 100%; height: 280px; background: #eee; }
        .card-img img { width: 100%; height: 100%; object-fit: cover; }
        .card-body { padding: 15px; }
        .card-body h3 { font-size: 18px; color: var(--accent); margin-bottom: 8px; }
        .card-info { font-size: 13px; color: #444; line-height: 1.6; }

        /* LIST VIEW - Full Auto Adjust Screen Box */
        .table-container { 
            background: white; border-radius: 15px; border: 2px solid #e2e8f0;
            max-height: calc(100vh - 320px); overflow: auto; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        table { width: 100%; border-collapse: separate; border-spacing: 0; min-width: 1600px; }
        th { background: #0f172a; color: white; padding: 15px; text-align: left; position: sticky; top: 0; z-index: 10; border-bottom: 3px solid var(--accent); }
        
        /* Sticky Column for Name */
        .sticky-col { position: sticky; left: 0; background: #fff !important; z-index: 5; border-right: 2px solid #e2e8f0; }
        th.sticky-col { z-index: 11; background: #0f172a !important; }
        
        td { padding: 12px 15px; border-bottom: 1px solid #f1f5f9; font-size: 14px; }
        .t-img { width: 200px; height: 200px; border-radius: 10px; object-fit: cover; border: 2px solid #ddd; }

        /* MODAL POPUP (Side-by-Side) */
        #modalOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center; z-index: 2000; padding: 15px; backdrop-filter: blur(5px); }
        .modal-content { background: white; width: 95%; max-width: 1100px; border-radius: 25px; display: flex; overflow: hidden; max-height: 90vh; position: relative; }
        .modal-left { flex: 1; background: #000; display: flex; align-items: center; justify-content: center; }
        .modal-left img { max-width: 100%; max-height: 90vh; object-fit: contain; }
        .modal-right { flex: 1.3; padding: 25px; overflow-y: auto; background: #fff; }
        .modal-right h2 { font-size: 26px; color: var(--accent); margin-bottom: 15px; border-bottom: 4px solid var(--accent); padding-bottom: 10px; }
        .detail-row { display: flex; border-bottom: 1px solid #f0f0f0; padding: 8px 0; font-size: 14px; }
        .detail-label { width: 180px; color: #64748b; font-size: 11px; text-transform: uppercase; }
        .detail-value { flex: 1; color: var(--primary); }

        #loader { text-align: center; padding: 50px; font-size: 20px; color: var(--accent); }
        .spin { animation: spin 1s infinite linear; font-size: 40px; margin-bottom: 20px; }
        @keyframes spin { 100% {transform: rotate(360deg);} }

        @media (max-width: 800px) {
            .modal-content { flex-direction: column; overflow-y: auto; }
            .modal-left { height: 250px; }
        }
    </style>
<link rel="me" href="https://www.blogger.com/profile/01505366874490678870" />
<meta name='google-adsense-platform-account' content='ca-host-pub-1556223355139109'/>
<meta name='google-adsense-platform-domain' content='blogspot.com'/>
</head>
<body>

<header>
    <h1>ADARSH MASTER PORTAL 2026</h1>
    <div class="search-box">
        <i class="fas fa-search"></i>
        <input type="text" id="mainSearch" placeholder="ADVANCED SEARCH: Name, Village, Phone, ID, School...">
    </div>
</header>

<div class="stats-bar">
    <div class="stat-card"><h4>TOTAL</h4><p id="statTotal">0</p></div>
    <div class="stat-card" style="border-color:var(--success)"><h4>FOUND</h4><p id="statLinked">0</p></div>
    <div class="stat-card" style="border-color:var(--danger)"><h4>MISSING</h4><p id="statMissing">0</p></div>
</div>

<div class="controls">
    <div class="btn-group">
        <button class="btn btn-f active" onclick="setFilter('all', this)">ALL DATA</button>
        <button class="btn btn-f" onclick="setFilter('linked', this)">WITH PHOTO</button>
        <button class="btn btn-f" onclick="setFilter('missing', this)">NO PHOTO</button>
    </div>
    <div class="btn-group">
        <button class="btn active" id="gBtn" onclick="setView('grid')">GRID VIEW</button>
        <button class="btn" id="lBtn" onclick="setView('list')">LIST VIEW</button>
    </div>
</div>

<div id="displayWrapper">
    <div id="loader"><i class="fas fa-circle-notch spin"></i><br><br>STREAMING DATABASE...</div>
    <div id="dataDisplay"></div>
</div>

<!-- Side-by-Side Modal -->
<div id="modalOverlay" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-left"><img id="modalImg" src=""></div>
        <div class="modal-right">
            <h2 id="modalName">STUDENT DETAILS</h2>
            <div id="modalDetails"></div>
        </div>
    </div>
</div>

<script>
    const excelUrl = "https://raw.githubusercontent.com/hiteshjangir8057/Adarsh2026/main/VIDYA%20NIKETAN%202025-26%20Correct%20New.xlsx";
    const photoBase = "https://raw.githubusercontent.com/hiteshjangir8057/Adarsh2026/main/Photos/";

    let masterData = [];
    let filteredData = [];
    let currentView = 'grid';
    let currentFilter = 'all';
    let streamIndex = 0;
    const batchSize = 30;

    // Headings for popup mapping
    const heads = ["S.No.", "Sr.No.", "Photo", "Class", "STUDENT'S NAME", "Father's Name", "Mother's Name", "Date Of Birth", "Village", "Phone", "School", "Gender", "Social Category", "Religion", "Mother Tongue", "Rural/Urban", "Date of Admission", "Admission Number", "Email Address"];

    async function init() {
        try {
            const res = await fetch(excelUrl + "?t=" + Date.now());
            const arrayBuffer = await res.arrayBuffer();
            const workbook = XLSX.read(arrayBuffer, { type: 'array' });
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            const json = XLSX.utils.sheet_to_json(sheet);

            masterData = json.filter(row => row["STUDENT'S NAME"] || row["Name"]).map(row => {
                const idMatch = row["Photo"] || row["Sr.No."] || row["S.No."] || "";
                return {
                    imgID: String(idMatch).trim(),
                    name: String(row["STUDENT'S NAME"] || row["Name"] || "UNKNOWN").trim(),
                    father: String(row["Father's Name"] || row["Father Name"] || "---").trim(),
                    mother: String(row["Mother's Name"] || row["Mother Name"] || "---").trim(),
                    class: String(row["Class"] || "---").trim(),
                    village: String(row["Village"] || "---").trim(),
                    phone: String(row["Phone"] || "---").trim(),
                    allDetails: row,
                    hasPhoto: null,
                    photoUrl: ""
                };
            });

            document.getElementById('loader').style.display = 'none';
            document.getElementById('statTotal').innerText = masterData.length;
            
            // Render call
            searchAndFilter();
            syncPhotos();
        } catch (e) {
            document.getElementById('loader').innerHTML = "ERROR: Failed to fetch data. Check Internet.";
        }
    }

    function syncPhotos() {
        masterData.forEach(item => {
            if(!item.imgID) return;
            const img = new Image();
            img.src = `${photoBase}${item.imgID}.JPG`;
            img.onload = () => { item.hasPhoto = true; item.photoUrl = img.src; refreshStats(); };
            img.onerror = () => {
                const img2 = new Image();
                img2.src = `${photoBase}${item.imgID}.jpg`;
                img2.onload = () => { item.hasPhoto = true; item.photoUrl = img2.src; refreshStats(); };
                img2.onerror = () => { item.hasPhoto = false; refreshStats(); };
            };
        });
    }

    function refreshStats() {
        const found = masterData.filter(i => i.hasPhoto === true).length;
        document.getElementById('statLinked').innerText = found;
        document.getElementById('statMissing').innerText = masterData.length - found;
    }

    function searchAndFilter() {
        streamIndex = 0;
        const val = document.getElementById('mainSearch').value.toLowerCase().trim();
        
        filteredData = masterData.filter(item => {
            const matchesSearch = Object.values(item.allDetails).some(v => String(v).toLowerCase().includes(val));
            const matchesFilter = currentFilter === 'all' || 
                                 (currentFilter === 'linked' && item.hasPhoto === true) || 
                                 (currentFilter === 'missing' && item.hasPhoto === false);
            return matchesSearch && matchesFilter;
        });

        const container = document.getElementById('dataDisplay');
        container.innerHTML = '';
        
        if (currentView === 'list') {
            container.className = 'table-container';
            container.innerHTML = `<table><thead><tr><th class="sticky-col">NAME</th><th>PHOTO (5X)</th><th>ID</th><th>FATHER</th><th>MOTHER</th><th>CLASS</th><th>VILLAGE</th><th>PHONE</th><th>SCHOOL</th></tr></thead><tbody id="tableBody"></tbody></table>`;
        } else {
            container.className = 'grid-layout';
        }
        continueStreaming();
    }

    function continueStreaming() {
        const target = currentView === 'list' ? document.getElementById('tableBody') : document.getElementById('dataDisplay');
        const nextBatch = filteredData.slice(streamIndex, streamIndex + batchSize);
        
        let chunk = "";
        nextBatch.forEach(item => {
            const photo = item.hasPhoto ? item.photoUrl : 'https://via.placeholder.com/300?text=NO+PHOTO';
            const realIdx = masterData.indexOf(item);
            
            if(currentView === 'grid') {
                chunk += `
                <div class="card" onclick="openModal(${realIdx})">
                    <div class="card-img"><img src="${photo}" loading="lazy"></div>
                    <div class="card-body">
                        <h3>${item.name}</h3>
                        <div class="card-info">
                            <p><b>FATHER:</b> ${item.father}</p>
                            <p><b>MOTHER:</b> ${item.mother}</p>
                            <p><b>CLASS:</b> ${item.class} | <b>ID:</b> ${item.imgID}</p>
                            <p><b>VILLAGE:</b> ${item.village}</p>
                        </div>
                    </div>
                </div>`;
            } else {
                chunk += `
                <tr onclick="openModal(${realIdx})" style="cursor:pointer">
                    <td class="sticky-col" style="color:var(--accent)">${item.name}</td>
                    <td><img src="${photo}" class="t-img" loading="lazy"></td>
                    <td><b>${item.imgID}</b></td>
                    <td>${item.father}</td>
                    <td>${item.mother}</td>
                    <td>${item.class}</td>
                    <td>${item.village}</td>
                    <td>${item.phone}</td>
                    <td>${item.allDetails["School"] || '---'}</td>
                </tr>`;
            }
        });

        target.insertAdjacentHTML('beforeend', chunk);
        streamIndex += batchSize;
        if (streamIndex < filteredData.length) setTimeout(continueStreaming, 50);
    }

    function openModal(idx) {
        const item = masterData[idx];
        document.getElementById('modalImg').src = item.hasPhoto ? item.photoUrl : 'https://via.placeholder.com/400?text=NO+PHOTO';
        document.getElementById('modalName').innerText = item.name;
        
        let detHtml = "";
        heads.forEach(h => {
            detHtml += `<div class="detail-row"><div class="detail-label">${h}</div><div class="detail-value">${item.allDetails[h] || '---'}</div></div>`;
        });
        document.getElementById('modalDetails').innerHTML = detHtml;
        document.getElementById('modalOverlay').style.display = 'flex';
    }

    function closeModal() { document.getElementById('modalOverlay').style.display = 'none'; }

    // Controls Logic
    document.getElementById('mainSearch').addEventListener('input', searchAndFilter);

    function setFilter(f, btn) {
        currentFilter = f;
        document.querySelectorAll('.btn-f').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        searchAndFilter();
    }

    function setView(v) {
        currentView = v;
        document.getElementById('gBtn').classList.toggle('active', v==='grid');
        document.getElementById('lBtn').classList.toggle('active', v==='list');
        searchAndFilter();
    }

    init();
</script>
</body>
</html>
